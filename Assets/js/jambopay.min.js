$(function(){var $loader=$("#jpLoader"),ACTIVE_BILL=null,$create=$("button#JPWcreate"),$bill=$("button#JPWbill"),$print=$("a#JPWprint"),$billStatus=$("button#JPWstatus"),PIN=null,JamboPay={init:function(){$create.hide(),$bill.hide(),$print.hide(),$billStatus.hide(),$create.click(function(){JamboPay.createWallet()}),$bill.click(function(){JamboPay.postBill()}),$billStatus.click(function(){JamboPay.checkBillStatus()}),this.checkWalletExists()},createWallet:function(){$create.prop("disabled",!0),swal({text:"Enter the desired Jambopay wallet PIN",content:{element:"input",attributes:{placeholder:"Enter the walllet PIN",type:"text"}},button:{text:"Create Wallet",closeModal:!1}}).then(function(name){if(!name)throw null;return PIN=name,fetch(JP_CREATE_WALLET_URL+"?pin="+name)}).then(function(results){return results.json()}).then(function(result){result.success?(swal({title:"Wallet created",text:"Jambopay wallet has been created with pin "+PIN+", go ahead to post bill",icon:"success"}),$create.hide(),$bill.show()):swal("Oh no!","There is an issue with your network","error")}).catch(function(err){err?swal("Oh no!","There is an issue with your network","error"):(swal.stopLoading(),swal.close())})},postBill:function(){var JPAmount=$("input[name=JPAmount]").val();JPAmount?($bill.hide(),$.ajax({url:JP_POST_BILL_URL,dataType:"JSON",type:"POST",data:{amount:parseInt(JPAmount)},beforeSend:function(){$loader.show()},success:function(response){$loader.hide(),response.success?($print.show(),$billStatus.show(),$bill.hide(),ACTIVE_BILL=response.bill.BillNumber,$print.attr("href",JP_BILL_PRINT_URL+"?bill="+ACTIVE_BILL),swal({title:"Bill Posted!",text:"Request the customer to complete transaction. Bill ID is "+ACTIVE_BILL,button:"Nice",icon:"info",timer:1e4})):swal({title:"Oh No!",text:response.error,icon:"error"})},error:function(){swal({title:"Oh No!",text:"Network issue",icon:"error"})}})):alertify.error("Please enter amount to bill")},checkBillStatus:function(){$.ajax({url:JP_BILL_STATUS_URL,dataType:"JSON",type:"POST",data:{bill:ACTIVE_BILL},beforeSend:function(){$billStatus.hide(),$loader.show()},success:function(response){$billStatus.show(),$loader.hide(),response.success?(alertify.success("Bill stated: "+response.status.PaymentStatusName),"1"==response.status.PaymentStatus&&(JP_PAID=!0),JP_PAID&&($billStatus.hide(),$("input[name=JPAmount]").prop("readonly",!0),$("input[name=JPid]").val(ACTIVE_BILL),show_information())):alertify.log(response.error)},error:function(){swal({title:"Oh No!",text:"Network issues",icon:"error"})}})},checkWalletExists:function(){$.ajax({url:JP_WALLET_EXIST_URL,dataType:"JSON",type:"GET",beforeSend:function(){$loader.show()},success:function(response){$loader.hide(),response.success?(response.exist||$("#wallet_op").html("<p class='text-warning'><i class='fa fa-info'></i> Patient has no jambopay wallet</p>"),$bill.show()):alertify.log(response.error)},error:function(){$("#wallet_op").html("<span class='text-warning'>Cannot contact jambopay for wallet information</span>"),swal({title:"Oh No!",text:"Network error",icon:"error"})}})}};JamboPay.init()});